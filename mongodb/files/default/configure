#!/usr/bin/env bash

echo "configuring replica set"

HOST=$1
STATUS=$2
MASTER=`mongo --quiet --eval 'db.isMaster().ismaster'`

echo ${HOST}
echo ${STATUS}

if [ "$MASTER" == "true" ]; then
    echo "configuration mongodb primary node"
    if [ "$STATUS" == "online" ]; then
      echo "adding ${HOST} into the replica set"
      mongo --eval "rs.add('$HOST')"
    elif [ "$STATUS" == "stopped" ]; then
      echo "removing ${HOST} from the replica set"
      mongo --eval "rs.remove('$HOST')"
    fi
else
    echo "skipping mongodb secondary node"
fi